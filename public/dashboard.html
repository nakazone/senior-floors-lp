<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a2036">
    <title>Senior Floors - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="header-content">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">‚ò∞</button>
                <h1>
                    <a href="dashboard.html">
                        <img src="assets/SeniorFloors.png" alt="Senior Floors" class="logo-image" onerror="this.style.display='none'">
                        <span class="mobile-hidden">Senior Floors CRM</span>
                        <span class="mobile-only">CRM</span>
                    </a>
                </h1>
                <div class="header-actions">
                    <span id="userName" class="user-name mobile-hidden"></span>
                    <button id="logoutBtn" class="btn btn-secondary">Logout</button>
                </div>
            </div>
        </header>
        
        <div class="mobile-overlay" id="mobileOverlay"></div>
        
        <main class="dashboard-main">
            <div class="dashboard-sidebar" id="dashboardSidebar">
                <nav class="sidebar-nav">
                    <a href="#" class="nav-item active" data-page="dashboard">
                        <span>üìä</span> Dashboard
                    </a>
                    <a href="#" class="nav-item" data-page="leads">
                        <span>üìã</span> Leads
                    </a>
                    <a href="#" class="nav-item" data-page="crm">
                        <span>üéØ</span> CRM
                    </a>
                    <a href="#" class="nav-item" data-page="customers">
                        <span>üë•</span> Customers
                    </a>
                    <a href="#" class="nav-item" data-page="quotes">
                        <span>üí∞</span> Quotes
                    </a>
                    <a href="#" class="nav-item" data-page="projects">
                        <span>üèóÔ∏è</span> Projects
                    </a>
                    <a href="#" class="nav-item" data-page="schedule">
                        <span>üìÖ</span> Schedule
                    </a>
                    <a href="#" class="nav-item" data-page="financeiro">
                        <span>üíµ</span> Financeiro
                    </a>
                    <a href="#" class="nav-item" data-page="activities">
                        <span>üìù</span> Activities
                    </a>
                    <a href="#" class="nav-item" data-page="users">
                        <span>üë§</span> Users
                    </a>
                </nav>
            </div>
            
            <div class="dashboard-content">
                <div id="loading" class="loading" style="display: none;">Loading...</div>
                <div id="error" class="error-message" style="display: none;"></div>
                
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                        <h2 class="page-title">Dashboard</h2>
                        <button class="btn btn-primary" onclick="loadDashboard()">üîÑ Refresh</button>
                    </div>
                    
                    <div id="dashboardStats" class="stats-grid">
                        <!-- Stats ser√£o carregadas aqui -->
                    </div>
                    
                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>Leads por Status</h3>
                            <div class="chart-container">
                                <canvas id="leadsStatusChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Leads por M√™s</h3>
                            <div class="chart-container">
                                <canvas id="leadsMonthlyChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Receita Projetada</h3>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Performance por Vendedor</h3>
                            <div class="chart-container">
                                <canvas id="salesPerformanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: var(--spacing-md); margin-top: var(--spacing-md);">
                        <div class="chart-card">
                            <h3>Leads Recentes</h3>
                            <div id="recentLeads" style="max-height: 400px; overflow-y: auto;"></div>
                        </div>
                        <div class="chart-card">
                            <h3>Visitas Pr√≥ximas</h3>
                            <div id="upcomingVisits" style="max-height: 400px; overflow-y: auto;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Leads Page -->
                <div id="leadsPage" class="page-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap; gap: var(--spacing-sm);">
                        <h2 class="page-title">Leads</h2>
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary" onclick="showNewLeadModal()">+ Novo Lead</button>
                            <button class="btn btn-secondary" onclick="refreshLeads()">üîÑ Refresh</button>
                        </div>
                    </div>
                    
                    <!-- List View -->
                    <div id="listView">
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Zipcode</th>
                                    <th>Status</th>
                                    <th>Source</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="leadsTableBody">
                                <tr><td colspan="9" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageLeads" class="btn btn-secondary" onclick="changePageLeads(-1)">Previous</button>
                        <span id="pageInfoLeads">Page 1</span>
                        <button id="nextPageLeads" class="btn btn-secondary" onclick="changePageLeads(1)">Next</button>
                    </div>
                    </div>
                </div>
                
                <!-- CRM Page (Kanban) -->
                <div id="crmPage" class="page-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap; gap: var(--spacing-sm);">
                        <h2 class="page-title">CRM - Kanban Board</h2>
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary" onclick="showNewLeadModal()">+ Novo Lead</button>
                            <button class="btn btn-secondary" onclick="if(typeof loadKanbanBoard === 'function') loadKanbanBoard(); else if(typeof loadCRMKanban === 'function') loadCRMKanban();">üîÑ Refresh</button>
                        </div>
                    </div>
                    
                    <div id="kanbanView" style="display: block;">
                        <div id="kanbanBoard" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-md);"></div>
                    </div>
                </div>
                
                <!-- Modals -->
                <!-- New Lead Modal -->
                <div id="newLeadModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Novo Lead</h3>
                            <button class="modal-close" onclick="closeModal('newLeadModal')">&times;</button>
                        </div>
                        <form id="newLeadForm" onsubmit="createLeadManual(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nome *</label>
                                    <input type="text" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label>Email *</label>
                                    <input type="email" name="email" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Telefone *</label>
                                    <input type="tel" name="phone" required>
                                </div>
                                <div class="form-group">
                                    <label>CEP *</label>
                                    <input type="text" name="zipcode" pattern="[0-9]{5}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fonte</label>
                                    <select name="source">
                                        <option value="Manual">Manual</option>
                                        <option value="Referral">Indica√ß√£o</option>
                                        <option value="Website">Website</option>
                                        <option value="Social Media">Redes Sociais</option>
                                        <option value="Other">Outro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Designar para</label>
                                    <select name="owner_id" id="newLeadOwnerSelect">
                                        <option value="">N√£o designar</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Prioridade</label>
                                    <select name="priority">
                                        <option value="low">Baixa</option>
                                        <option value="medium" selected>M√©dia</option>
                                        <option value="high">Alta</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Valor Estimado</label>
                                    <input type="number" name="estimated_value" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Mensagem</label>
                                <textarea name="message" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Notas</label>
                                <textarea name="notes" rows="2"></textarea>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-secondary" onclick="closeModal('newLeadModal')">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Criar Lead</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Assign Lead Modal -->
                <div id="assignLeadModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Designar Lead</h3>
                            <button class="modal-close" onclick="closeModal('assignLeadModal')">&times;</button>
                        </div>
                        <form id="assignLeadForm" onsubmit="assignLead(event)">
                            <input type="hidden" id="assignLeadId" name="lead_id">
                            <div class="form-group">
                                <label>Designar para</label>
                                <select name="owner_id" id="assignLeadOwnerSelect" required>
                                    <option value="">Selecione um usu√°rio...</option>
                                </select>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-secondary" onclick="closeModal('assignLeadModal')">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Designar</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Follow-up Modal -->
                <div id="followupModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Novo Follow-up</h3>
                            <button class="modal-close" onclick="closeModal('followupModal')">&times;</button>
                        </div>
                        <form id="followupForm" onsubmit="createFollowup(event)">
                            <input type="hidden" id="followupLeadId" name="lead_id">
                            <div class="form-group">
                                <label>T√≠tulo *</label>
                                <input type="text" name="title" required placeholder="ex: Ligar para cliente">
                            </div>
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <textarea name="description" rows="3"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Data/Hora *</label>
                                    <input type="datetime-local" name="due_date" required>
                                </div>
                                <div class="form-group">
                                    <label>Prioridade</label>
                                    <select name="priority">
                                        <option value="low">Baixa</option>
                                        <option value="medium" selected>M√©dia</option>
                                        <option value="high">Alta</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Designar para</label>
                                <select name="assigned_to" id="followupAssignedSelect">
                                    <option value="">Eu mesmo</option>
                                </select>
                            </div>
                            <div class="btn-group">
                                <button type="button" class="btn btn-secondary" onclick="closeModal('followupModal')">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Criar Follow-up</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Customers Page -->
                <div id="customersPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>Customers</h2>
                        <button class="btn btn-primary" onclick="showNewCustomerModal()">+ New Customer</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>City</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                                <tr><td colspan="9" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageCustomers" class="btn btn-secondary" onclick="changePageCustomers(-1)">Previous</button>
                        <span id="pageInfoCustomers">Page 1</span>
                        <button id="nextPageCustomers" class="btn btn-secondary" onclick="changePageCustomers(1)">Next</button>
                    </div>
                </div>
                
                <!-- Quotes Page -->
                <div id="quotesPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>Estimates</h2>
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button class="btn btn-primary" onclick="window.open('estimate-builder.html', '_blank')">+ New Estimate</button>
                            <button class="btn btn-secondary" onclick="loadEstimateAnalytics()">Analytics</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Quote #</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Expires</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quotesTableBody">
                                <tr><td colspan="7" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageQuotes" class="btn btn-secondary" onclick="changePageQuotes(-1)">Previous</button>
                        <span id="pageInfoQuotes">Page 1</span>
                        <button id="nextPageQuotes" class="btn btn-secondary" onclick="changePageQuotes(1)">Next</button>
                    </div>
                </div>
                
                <!-- Projects Page -->
                <div id="projectsPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>Projects</h2>
                        <button class="btn btn-primary" onclick="showNewProjectModal()">+ New Project</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Customer</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Est. Cost</th>
                                    <th>Start Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                <tr><td colspan="8" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageProjects" class="btn btn-secondary" onclick="changePageProjects(-1)">Previous</button>
                        <span id="pageInfoProjects">Page 1</span>
                        <button id="nextPageProjects" class="btn btn-secondary" onclick="changePageProjects(1)">Next</button>
                    </div>
                </div>
                
                <!-- Schedule Page (Smart Scheduling Engine) -->
                <div id="schedulePage" class="page-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap; gap: var(--spacing-sm);">
                        <h2 class="page-title">Smart Scheduling</h2>
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button class="btn btn-secondary" onclick="showScheduleView('month')">üìÖ Month</button>
                            <button class="btn btn-secondary" onclick="showScheduleView('week')">üìÜ Week</button>
                            <button class="btn btn-secondary" onclick="showScheduleView('crew')">üë• Crew Timeline</button>
                            <button class="btn btn-primary" onclick="showNewScheduleModal()">+ Schedule Project</button>
                            <button class="btn btn-secondary" onclick="loadScheduleDashboard()">üîÑ Refresh</button>
                        </div>
                    </div>
                    
                    <!-- Forecast Dashboard -->
                    <div id="scheduleForecast" class="stats-grid" style="margin-bottom: var(--spacing-md);">
                        <!-- Forecast stats will be loaded here -->
                    </div>
                    
                    <!-- Calendar Views -->
                    <div id="scheduleMonthView" class="schedule-view">
                        <div id="scheduleCalendar" style="background: var(--bg-white); border-radius: 8px; padding: var(--spacing-md);">
                            <!-- Calendar will be rendered here -->
                        </div>
                    </div>
                    
                    <div id="scheduleWeekView" class="schedule-view" style="display: none;">
                        <div id="scheduleWeekCalendar" style="background: var(--bg-white); border-radius: 8px; padding: var(--spacing-md);">
                            <!-- Week view will be rendered here -->
                        </div>
                    </div>
                    
                    <div id="scheduleCrewView" class="schedule-view" style="display: none;">
                        <div id="scheduleCrewTimeline" style="background: var(--bg-white); border-radius: 8px; padding: var(--spacing-md);">
                            <!-- Crew timeline will be rendered here -->
                        </div>
                    </div>
                </div>
                    <div class="page-header">
                        <h2>Schedule / Visits</h2>
                        <button class="btn btn-primary" onclick="showNewVisitModal()">+ Schedule Visit</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Date/Time</th>
                                    <th>Lead/Customer</th>
                                    <th>Project</th>
                                    <th>Seller</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="visitsTableBody">
                                <tr><td colspan="7" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageVisits" class="btn btn-secondary" onclick="changePageVisits(-1)">Previous</button>
                        <span id="pageInfoVisits">Page 1</span>
                        <button id="nextPageVisits" class="btn btn-secondary" onclick="changePageVisits(1)">Next</button>
                    </div>
                </div>
                
                <!-- Financeiro Page -->
                <div id="financeiroPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>Financeiro / Contracts</h2>
                        <button class="btn btn-primary" onclick="showNewContractModal()">+ New Contract</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Customer</th>
                                    <th>Project</th>
                                    <th>Amount</th>
                                    <th>Payment Method</th>
                                    <th>Installments</th>
                                    <th>Start Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contractsTableBody">
                                <tr><td colspan="8" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageContracts" class="btn btn-secondary" onclick="changePageContracts(-1)">Previous</button>
                        <span id="pageInfoContracts">Page 1</span>
                        <button id="nextPageContracts" class="btn btn-secondary" onclick="changePageContracts(1)">Next</button>
                    </div>
                </div>
                
                <!-- Activities Page -->
                <div id="activitiesPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>Activities</h2>
                        <button class="btn btn-primary" onclick="showNewActivityModal()">+ New Activity</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Subject</th>
                                    <th>Related To</th>
                                    <th>User</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="activitiesTableBody">
                                <tr><td colspan="6" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageActivities" class="btn btn-secondary" onclick="changePageActivities(-1)">Previous</button>
                        <span id="pageInfoActivities">Page 1</span>
                        <button id="nextPageActivities" class="btn btn-secondary" onclick="changePageActivities(1)">Next</button>
                    </div>
                </div>
                
                <!-- Users Page -->
                <div id="usersPage" class="page-content" style="display: none;">
                    <div class="page-header">
                        <h2>Users</h2>
                        <button class="btn btn-primary" onclick="showNewUserModal()">+ New User</button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr><td colspan="8" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button id="prevPageUsers" class="btn btn-secondary" onclick="changePageUsers(-1)">Previous</button>
                        <span id="pageInfoUsers">Page 1</span>
                        <button id="nextPageUsers" class="btn btn-secondary" onclick="changePageUsers(1)">Next</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="dashboard.js"></script>
    <script src="leads-kanban.js"></script>
    <script src="schedule-engine.js"></script>
</body>
</html>
